diff -Nurp devil-1.7.7/src-IL/src/il_icon.c devil-1.7.7.new//src-IL/src/il_icon.c
--- src-IL/src/il_icon.c	2009-02-06 19:17:34.000000000 +0100
+++ src-IL/src/il_icon.c	2010-05-09 11:37:52.000000000 +0200
@@ -527,7 +527,7 @@ ILboolean ico_readpng_get_image(ICOIMAGE
 
 	// Expand low-bit-depth grayscale images to 8 bits
 	if (ico_color_type == PNG_COLOR_TYPE_GRAY && bit_depth < 8) {
-		png_set_gray_1_2_4_to_8(ico_png_ptr);
+		png_set_expand_gray_1_2_4_to_8(ico_png_ptr);
 	}
 
 	// Expand RGB images with transparency to full alpha channels
diff -Nurp devil-1.7.7/src-IL/src/il_png.c devil-1.7.7.new//src-IL/src/il_png.c
--- src-IL/src/il_png.c	2009-02-06 19:17:34.000000000 +0100
+++ src-IL/src/il_png.c	2010-05-09 11:37:40.000000000 +0200
@@ -280,7 +280,7 @@ ILboolean readpng_get_image(ILdouble dis
 
 	// Expand low-bit-depth grayscale images to 8 bits
 	if (png_color_type == PNG_COLOR_TYPE_GRAY && bit_depth < 8) {
-		png_set_gray_1_2_4_to_8(png_ptr);
+		png_set_expand_gray_1_2_4_to_8(png_ptr);
 	}
 
 	// Expand RGB images with transparency to full alpha channels
